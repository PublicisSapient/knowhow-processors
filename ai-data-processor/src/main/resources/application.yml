spring:
  application:
    name: ai-data-processor
  data:
    mongodb:
      uri:
  batch:
    jdbc:
      initialize-schema: always
    job:
      enabled: false
  task:
    scheduling:
      pool:
        size: 5
      thread-name-prefix: scheduling-
    execution:
      thread-name-prefix: task-

info:
  app:
    name: ai-data-processor
    description: Microservice used for preparing, enriching and storing data used by the AI components of the platform
    version: 14.1.0-SNAPSHOT

springdoc:
  swagger-ui:
    url: /v3/api-docs.yaml

server:
  port: 50026
  servlet:
    context-path: /api/ai-data-processor

logging:
  file:
    name: ./logs/ai-data-processor.log
  level:
    com:
      atlassian:
        jira: INFO
      publicissapient:
        kpidashboard:
          processor: DEBUG

togglz:
  feature-enums: com.publicissapient.kpidashboard.common.feature.FeatureEnum
  console:
    use-management-port: false
    enabled: true
    path: /togglz-console
    secured: true

management:
  health:
    rabbit:
      enabled: false
  endpoints:
    web:
      exposure:
        include: health
  endpoint:
    health:
      show-details: never

knowhow-api-config:
  base-url:
  api-key:
  endpoints:
    kpi-integration-values:
      path: /kpiIntegrationValues
    kpi-integration-values-kanban:
      path: /kpi-integration-values/kanban
    knowhow-evict-cache:
      path: /cache/clearCache/
  rate-limiting:
    max-concurrent-calls: 10
  retry-policy:
    max-attempts: 1
    min-backoff-duration: 5
    min-backoff-timeunit: SECONDS

shared-data-service-api-config:
  base-url:
  api-key:
  ai-usage-statistics-endpoint:
    path: /ai-usage/stats
  retry-policy:
    max-attempts: 3
    min-backoff-duration: 5
    min-backoff-timeunit: SECONDS

jobs:
  productivity-calculation:
    name: productivity-calculation
    batching:
      chunk-size: 100
    scheduling:
      cron: ${PRODUCTIVITY_CALC_CRON:0 0 16 * * FRI}
    calculation-config:
      # The sum of weights must be 1.0
      weights:
        quality: 0.3
        speed: 0.3
        efficiency: 0.25
        productivity: 0.15
      #Specifies the number of data points of all involved KPIs which will be taken into consideration for productivity gain calculation
      #Must be between 1 and 15
      data-points:
        count: 6
  kpi-maturity-calculation:
    name: kpi-maturity-calculation
    batching:
      chunk-size: 100
    scheduling:
      cron: ${KPI_MATURITY_CALC_CRON:0 0 14 * * FRI}
    calculation-config:
      maturity:
        weights:
          dora: 0.25
          value: 0.25
          speed: 0.25
          quality: 0.25
      data-points:
        count: 6
  ai-usage-statistics-collector:
    name: ai-usage-statistics-collector
    scheduling:
      cron: 0 0 0 ? * FRI
    batching:
      chunk-size: 10
  recommendation-calculation:
    name: recommendation-calculation
    batching:
      chunk-size: 50
    scheduling:
      cron: ${RECOMMENDATION_CALC_CRON:0 0 2 * * SAT}
    calculation-config:
      enabled-persona: PROJECT_ADMIN
      kpi-list:
        - kpi39
        - kpi46
        - kpi70
        - kpi172
        - kpi17
        - kpi8
        - kpi27
        - kpi156
        - kpi14
        - kpi37
        - kpi34
        - kpi111
        - kpi16
        - kpi42
        - kpi5
        - kpi82
        - kpi149
        - kpi113
        - kpi168
        - kpi73
        - kpi40
        - kpi164
        - kpi126
        - kpi35
        - kpi72
        - kpi38
  kpi-benchmark-calculation:
      name: kpi-benchmark-calculation
      batching:
        chunk-size: 10
      scheduling:
        cron: ${KPI_BENCHMARK_CALC_CRON:0 0 15 * * FRI}
        data-points:
          count: 6

mongo:
  ttl-index:
    configs:
      productivity-calculation:
        collection-name: productivity
        ttl-field: calculationDate
        expiration: 180
        time-unit: DAYS
        sort-direction: ASC
      ai-usage-statistics-collector:
        collection-name: ai_usage_statistics
        ttl-field: createdAt
        expiration: 180
        time-unit: DAYS
        sort-direction: ASC
      kpi-maturity-calculation:
        collection-name: kpi_maturity
        ttl-field: calculationDate
        expiration: 180
        time-unit: DAYS
        sort-direction: ASC
      recommendation-calculation:
        collection-name: recommendations_action_plan
        ttl-field: expiresOn
        expiration: 180
        time-unit: DAYS
        sort-direction: ASC
      job-execution-trace:
        collection-name: job_execution_trace_log
        ttl-field: executionStartedAt
        expiration: 180
        time-unit: DAYS
        sort-direction: ASC

# M2M Authentication for AI Gateway Client
m2mauth:
  secret: ${AUTH_SECRET}
  duration: 7200
  issuer-service-id: ${AUTH_ISSUER_SERVICE_ID}

# AI Gateway Configuration
ai-gateway-config:
  audience: ${AI_GATEWAY_AUDIENCE}
  base-url: ${AI_GATEWAY_BASE_URL}
  default-ai-provider: ${AI_GATEWAY_DEFAULT_PROVIDER:openai}